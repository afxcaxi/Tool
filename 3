local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local DISCORD_LINK = "https://discord.gg/FcEGmkNDDe"
local API_URL = "https://maomaostore.site/nSDs6oT4xDx.php"
local ERROR_MESSAGES = {
    INCOMPATIBLE_EXECUTOR = "âŒ Your Executor Is Not Compatible With Our Script! ğŸ”¥",
    CONNECTION_ERROR = "âŒ Connection Error - Check Discord: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘",
    VERIFICATION_FAILED = "âŒ Key Verification Failed, Script Execution Halted: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘"
}

local function kickPlayer(message)
    local player = Players.LocalPlayer
    if not player then return end
    
    player:Kick(message)
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/RISER93-ROBLOX/AfxcaxiRT1/refs/heads/main/Kicked"))()
    end)
end

local function verifyKey()
    -- Kiá»ƒm tra kháº£ nÄƒng gá»­i HTTP request
    local httpRequest = syn and syn.request or http_request or (http and http.request) or request
    if not httpRequest then
        kickPlayer(ERROR_MESSAGES.INCOMPATIBLE_EXECUTOR)
        return false
    end

    -- Láº¥y thÃ´ng tin player vÃ  key
    local player = Players.LocalPlayer
    local userId = player and player.UserId or 0
    local authKey = getgenv().Key or ""

    -- Gá»­i request tá»›i API
    local success, response = pcall(function()
        return httpRequest({
            Url = API_URL,
            Method = "POST",
            Headers = {
                ["Authorization"] = "Bearer " .. authKey,
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode({iddiscord = tostring(userId)})
        })
    end)

    if not success or not response then
        kickPlayer(ERROR_MESSAGES.CONNECTION_ERROR)
        return false
    end

    -- Kiá»ƒm tra mÃ£ tráº¡ng thÃ¡i HTTP
    if response.StatusCode ~= 200 then
        kickPlayer("âŒ API Error (Status: " .. response.StatusCode .. "): " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        return false
    end

    -- Giáº£i mÃ£ response
    local decodedResponse
    success, decodedResponse = pcall(HttpService.JSONDecode, HttpService, response.Body)
    if not success or not decodedResponse then
        kickPlayer("âŒ Invalid API Response: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        return false
    end

    -- Kiá»ƒm tra káº¿t quáº£ tá»« API
    if not decodedResponse.success then
        local errorMsg = decodedResponse.message or "Verification Failed"
        if errorMsg == "Authorization required" then
            kickPlayer("âŒ Authorization Key Missing: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        elseif errorMsg == "Invalid authorization key" then
            kickPlayer("âŒ Invalid Key: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        elseif errorMsg == "Discord ID required" then
            kickPlayer("âŒ Discord ID Missing: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        else
            kickPlayer("âŒ " .. errorMsg .. ": " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        end
        return false
    end

    -- Kiá»ƒm tra tráº¡ng thÃ¡i redeemer
    if decodedResponse.redeemer == false and decodedResponse.message == "Key already used" then
        kickPlayer("âŒ Key Already Used: " .. DISCORD_LINK .. " ğŸš«ğŸ”‘")
        return false
    end

    print("ğŸš€ Key Authentication Successful, Initiating Script Execution... ğŸ‰")
    return true
end

-- Thá»±c thi kiá»ƒm tra key
if not verifyKey() then
    kickPlayer(ERROR_MESSAGES.VERIFICATION_FAILED)
end
